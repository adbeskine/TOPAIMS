<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <title>TopMarks - {{ job.address }}</title>
  </head>
  <body>

  {% if messages %}
    {% for message in messages %}
    {{ message }}
    {% endfor %}
  {% endif %}



  	<!-- PROFILE -->

    <div class="card border-primary text-center bg- {{ profile_colour }} mb-5" id="Profile">

    	<div class="card-header">
    		<div class="container">
    		<ul class="nav">
    		  <li class="nav-item dropdown">
    		  	<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" id="status_menu_toggle">Status</a>
    		     <div class="dropdown-menu" id="status_menu">
    		    	<a class="dropdown-item" id="Quote_status_change" href="{% url 'update_job' job.job_id 'quote' %}">Quote</a>
    		    	<a class="dropdown-item" id="Ongoing_status_change" href="{% url 'update_job' job.job_id 'ongoing' %}">Ongoing</a>
    		    	<a class="dropdown-item" id="Completed_status_change" href="{% url 'update_job' job.job_id 'completed' %}">Complete</a>
    		      </div>
    		  </li>
    		</ul>
    	  </div>
    	</div>

    	<div class="card-body">
    		Name - {{ job.name }} <br>
    		Email - {{ job.email }}<br>
    		Phone - {{ job.phone }}<br>
    		Quote
    	</div>
    	<div class="card-footer">
    		{{ job.address }}
    	</div>
    </div>


    <!-- NOTES -->

    <div class="card border-primary text-center mb-5" id="notes_panel">

    	<div class="card-header">
    		<h3>NOTES</h3>
    	</div>
    	<div class="card-body">

    		{% for note in notes %}
    		<div class="card border-black text-center mb-2" id="Note_{{ note.pk }}">
    			<div class="card-header">
    				{{ note.Title }}
    			</div>
    			<div class="card-body">
    				<p class="card-text"> {{ note.Text }} </p>
    			</div>
    		</div>
    		{% endfor %}

    		<!-- New note form -->
    		<div class="card border-black text-center">
    			<div class="card-header">
    				NEW NOTE
    			</div>
    			<div class="card-body">
    				<form action="{% url 'new_note' job.job_id %}" method="post" id="new_note_form">
    				{% csrf_token %}
    				{{ new_note_form }}
    				<input type="Submit" value="Add Note" id="Add_note">
    			  </form>
    			</div>
    		</div>
    	</div>
    </div>


    <!-- SCHEDULE OF ITEMS -->

    <h5>{{ now }}</h5>

    <div class="card border-primary text-center mb-5" id="schedule_of_items_panel">

      <div class="card-header">
        <h3>SCHEDULE OF ITEMS</h3>
      </div>
      <div class="card-body">

        {% for SI in scheduled_items %}
          {% if SI in needed_items %} 
            <div class="card border-black text-center bg-success" id="schedule_item_{{ SI.pk }}">
          {% endif %}
          {% if SI not in needed_items %}
            <div class="card border-black text-center " id="schedule_item_{{ SI.pk }}">
          {% endif %}
          <div class="card-body">
            <p class="card-text"> {{ SI.description }} X {{ SI.quantity}} | 
              
              <button type="button" class="btn btn-grey" data-toggle="modal" data-target="#date_form_modal_{{ SI.pk }}" id="schedule_item_{{ SI.pk }}_date">{{ SI.date_1}}</button> 

            {% if SI.date_1 != SI.date_2 %}

            - <button type="button" class="btn btn-grey" data-toggle="modal" data-target="#date_form_modal">{{ SI.date_2 }}</button>
            {% endif %} </p>
          </div>
        </div>

        {% endfor %}

        <!-- New item form -->
        <div class="card border-black text-center">
          <div class="card-header">
            NEW ITEM
          </div>
          <div class="card-body">
            <form action="{% url 'new_schedule_item' job.job_id %}" method="post" id="new_note_form">
            {% csrf_token %}
            {{ new_scheduled_item_form }}
            <input type="Submit" value="Add" id="schedule_item_add_button">
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

         <!-- modal update item date form -->
      
      {% for SI in scheduled_items %}

      <div class="modal fade" id="date_form_modal_{{ SI.pk }}" tabindex="-1" role="dialog" aria-labelledby="date_form_modalLabel" aria-hidden="true">
       <div class="modal-dialog" role="document">
         <div class="modal-content">
           <div class="modal-header">
             <h5 class="modal-title" id="date_form_modalLabel">Configure</h5>
             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
               <span aria-hidden="true">&times;</span>
             </button>
           </div>
           <div class="modal-body">

                <ul class="nav nav-tabs" role="tablist">
                  <li class="nav-item">
                    <a class="nav-link" href="#date" role="tab" data-toggle="tab">Date</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#delete_{{ SI.pk }}" role="tab" data-toggle="tab" id="delete_tab_{{SI.pk}}">Delete</a>
                  </li>
                </ul>

                <div class="tab-content">

                  <div role="tabpanel" class="tab-pane in active" id="date">
                    <form action="{% url 'schedule_item' 'update' SI.pk %}" method="post" id="something">
                      {% csrf_token %}
                      {{ update_date_form}}
                      <input type="Submit" value="Update" id="schedule_item_update_button">
                    </form>
                  </div>

                  <div role="tabpanel" class="tab-pane" id="delete_{{ SI.pk }}">
                    <form action="{% url 'schedule_item' 'delete' SI.pk %}" method="post">
                      {% csrf_token %}
                      <input type="Submit" value="Delete '{{SI.description}}'" id="schedule_item_{{ SI.pk }}_delete">
                    </form>
                  </div>
                
                </div>

           </div>
           <div class="modal-footer">
             <button type="button" class="btn btn-secondary" data-dismiss="modal" id="close_modal_{{ SI.pk}}">Cancel</button>
           </div>
         </div>
       </div>
     </div> 

     {% endfor %}

    <!-- SITE MANAAGEMENT-->

    <div class="card border-primary text-center mb-5" id="site_management_panel">

      <div class="card_header">
        <h3>SITE MANAGEMENT</h3>
      </div>

      <div class="card body">

        {% for NI in needed_items %}
        <div class="card border-black text-center" id="needed_item_{{ NI.pk }}">
          <div class="card-body">

            <!-- schedule items-->
            {% if NI.model == "Scheduled_items" %}
                  <p class="card-text"> {{ NI.description }} X {{ NI.quantity}} | {{ NI.date_1}}{% if date_1 != date_2 %}-{{ NI.date_2 }}{% endif %} </p>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>










   <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  </body>
</html>